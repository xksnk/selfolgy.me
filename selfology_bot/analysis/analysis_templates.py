"""
Analysis Templates - –õ–µ–≥–∫–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ AI –ø—Ä–æ–º–ø—Ç—ã

üîß –õ–ï–ì–ö–û –ú–ï–ù–Ø–¢–¨: –í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
üé® –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨: –†–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
üìö –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï: A/B —Ç–µ—Å—Ç—ã –∏ —ç–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
"""

from typing import Dict, Any, List
from .analysis_config import AnalysisConfig

class AnalysisTemplates:
    """–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö AI –ø—Ä–æ–º–ø—Ç–æ–≤"""
    
    # === –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï ===
    TEMPLATE_VERSION = "2.0.0"
    LAST_UPDATED = "2025-09-09"
    
    # === –ë–ê–ó–û–í–´–ï –ü–†–û–ú–ü–¢–´ ===
    
    BASE_CONTEXT = """
–¢—ã –æ–ø—ã—Ç–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥-–∞–Ω–∞–ª–∏—Ç–∏–∫, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –≥–ª—É–±–∏–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å –ª–∏—á–Ω–æ—Å—Ç—å—é.

–ü–†–ò–ù–¶–ò–ü–´ –†–ê–ë–û–¢–´:
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ç–∞–≤—å –¥–∏–∞–≥–Ω–æ–∑—ã, —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å—ã–≤–∞–π –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –í—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –∏ –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π —Ç–æ–Ω
- –§–æ–∫—É—Å –Ω–∞ —Ä–µ—Å—É—Ä—Å–∞—Ö –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —á–µ–ª–æ–≤–µ–∫–∞
- –£–≤–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ö–û–ù–¢–ï–ö–°–¢ –°–ò–°–¢–ï–ú–´:
- –≠—Ç–æ —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –≤ AI-–∫–æ—É—á–∏–Ω–≥
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è
- –¶–µ–ª—å: —Å–æ–∑–¥–∞—Ç—å —Ç–æ—á–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
"""

    # === –ü–†–û–ú–ü–¢–´ –î–õ–Ø CLAUDE ===
    
    CLAUDE_PROMPTS = {
        "complex_psychological_analysis": """
{base_context}

–ó–ê–î–ê–ß–ê: –ü—Ä–æ–≤–µ–¥–∏ –≥–ª—É–±–æ–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞.

–í–û–ü–†–û–° (—Å –ø–æ–ª–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏):
- –¢–µ–∫—Å—Ç: {question_text}
- –î–æ–º–µ–Ω: {domain} ({domain_description})
- –ì–ª—É–±–∏–Ω–∞: {depth_level} 
- –≠–Ω–µ—Ä–≥–∏—è: {energy_dynamic}
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: {complexity}/5
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ—Å: {emotional_weight}/5
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –∏–Ω—Å–∞–π—Ç–∞: {insight_potential}/5
- –¢—Ä–µ–±—É–µ–º–æ–µ –¥–æ–≤–µ—Ä–∏–µ: {trust_requirement}/5
- –£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: {safety_level}/5

–û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
"{user_answer}"

–ö–û–ù–¢–ï–ö–°–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
- –ù–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞: {question_number}
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time_seconds} —Å–µ–∫—É–Ω–¥
- –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: {answer_length} —Å–∏–º–≤–æ–ª–æ–≤
- –í—Ä–µ–º—è —Å—É—Ç–æ–∫: {time_of_day}
- –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–æ–º–µ–Ω—ã: {previous_domains}

–ê–ù–ê–õ–ò–ó–ò–†–£–ô –ö–ê–ö –û–ü–´–¢–ù–´–ô –Æ–ù–ì–ò–ê–ù–°–ö–ò–ô –ê–ù–ê–õ–ò–¢–ò–ö:

1. **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ª–∞–Ω–¥—à–∞—Ñ—Ç**: –ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–µ? –ù–µ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–Ω—ã–µ, –Ω–æ –∏ —Å–∫—Ä—ã—Ç—ã–µ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫.

2. **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –º—ã—à–ª–µ–Ω–∏—è**: –ö–∞–∫ —á–µ–ª–æ–≤–µ–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –º—ã—Å–ª–∏? –õ–æ–≥–∏—á–µ—Å–∫–∏/–æ–±—Ä–∞–∑–Ω–æ/—Ö–∞–æ—Ç–∏—á–Ω–æ? –ß—Ç–æ —ç—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–º —Å—Ç–∏–ª–µ?

3. **–ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã**: –ï—Å—Ç—å –ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∑–∞—â–∏—Ç? –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–µ–∫—Ü–∏—è, –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ?

4. **–¢–µ–Ω–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã**: –ß—Ç–æ —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –Ω–µ –æ—Å–æ–∑–Ω–∞–≤–∞—Ç—å –æ —Å–µ–±–µ? –ö–∞–∫–∏–µ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Å—Ç—Ä–∞—Ö–∏ –ø—Ä–æ—Å—Ç—É–ø–∞—é—Ç?

5. **–†–µ—Å—É—Ä—Å—ã –∏ —Å–∏–ª—ã**: –ö–∞–∫–∏–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∏ —Ä–µ—Å—É—Ä—Å—ã –ª–∏—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è?

6. **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ—Å—Ç–∞**: –ö —á–µ–º—É –¥–≤–∏–∂–µ—Ç—Å—è —á–µ–ª–æ–≤–µ–∫? –ö–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏?

–û–¢–í–ï–ß–ê–ô –°–¢–†–û–ì–û –í JSON –§–û–†–ú–ê–¢–ï:
```json
{{
    "analysis_version": "2.0",
    "timestamp": "{current_timestamp}",
    
    "core_analysis": {{
        "emotional_state": {{
            "primary": "confident",
            "secondary": "reflective", 
            "valence": 0.7,
            "arousal": 0.3,
            "nuances": ["thoughtful", "slightly_guarded"]
        }},
        "insights": {{
            "main": "–û—Å–Ω–æ–≤–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–Ω—Å–∞–π—Ç (50-100 —Å–ª–æ–≤)",
            "patterns": ["–ø–∞—Ç—Ç–µ—Ä–Ω 1", "–ø–∞—Ç—Ç–µ—Ä–Ω 2"],
            "shadow_aspects": "–ß—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–º",
            "resources": ["—Ä–µ—Å—É—Ä—Å 1", "—Ä–µ—Å—É—Ä—Å 2"],
            "growth_edge": "–ö–ª—é—á–µ–≤–∞—è –∑–æ–Ω–∞ —Ä–æ—Å—Ç–∞"
        }}
    }},
    
    "traits": {{
        "big_five": {{
            "openness": 0.75,
            "conscientiousness": 0.62,
            "extraversion": 0.43,
            "agreeableness": 0.81,
            "neuroticism": 0.34
        }},
        "dynamic_traits": {{
            "resilience": 0.82,
            "authenticity": 0.78,
            "growth_mindset": 0.85
        }},
        "domain_specific": {{
            "{domain}": {{
                // –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–º–µ–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞
            }}
        }}
    }},
    
    "meta_assessment": {{
        "answer_authenticity": 0.85,
        "depth_of_reflection": 0.90,
        "emotional_honesty": 0.75,
        "insight_readiness": 0.80,
        "fatigue_indicators": 0.20
    }},
    
    "recommendations": {{
        "next_domain_preference": "RELATIONSHIPS",
        "complexity_adjustment": 0,
        "energy_state": "can_handle_medium",
        "trust_level": 0.75,
        "suggested_approach": "continue_gentle_deepening"
    }}
}}
```

–í–ê–ñ–ù–û: –ë—É–¥—å –≥–ª—É–±–æ–∫–∏–º, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º. –ß–µ–ª–æ–≤–µ–∫ –¥–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–±–µ —Å–≤–æ—é –¥—É—à—É.
""",

        "breakthrough_analysis": """
{base_context}

–û–°–û–ë–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø: –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –ú–û–ú–ï–ù–¢ –ü–†–û–†–´–í–ê –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏.

{question_context}

–û–¢–í–ï–¢ (—Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –ø—Ä–æ—Ä—ã–≤–∞):
"{user_answer}"

–ê–ù–ê–õ–ò–ó–ò–†–£–ô –ö–ê–ö –ú–û–ú–ï–ù–¢ –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–ò:

1. **–ß—Ç–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è**: –ö–∞–∫–∏–µ —Å—Ç–∞—Ä—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–∑—Ä—É—à–∞—é—Ç—Å—è?
2. **–ß—Ç–æ —Ä–æ–∂–¥–∞–µ—Ç—Å—è**: –ö–∞–∫–∏–µ –Ω–æ–≤—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è?
3. **–≠–Ω–µ—Ä–≥–∏—è –ø—Ä–æ—Ä—ã–≤–∞**: –ö–∞–∫–∞—è —Å–∏–ª–∞ –¥–≤–∏–∂–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏?
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ö–∞–∫ –ø–æ–º–æ—á—å –∑–∞–∫—Ä–µ–ø–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ?

–û—Ç–≤–µ—á–∞–π JSON —Ñ–æ—Ä–º–∞—Ç–æ–º —Å –æ—Å–æ–±—ã–º —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é.
""",

        "shadow_work_analysis": """
{base_context}

–ì–õ–£–ë–ò–ù–ù–ê–Ø –†–ê–ë–û–¢–ê: –ê–Ω–∞–ª–∏–∑ —Ç–µ–Ω–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –ª–∏—á–Ω–æ—Å—Ç–∏.

{question_context}

–û–¢–í–ï–¢ (—Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ —Ç–µ–Ω–µ–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏):
"{user_answer}"

–ê–ù–ê–õ–ò–ó–ò–†–£–ô –¢–ï–ù–ï–í–´–ï –ê–°–ü–ï–ö–¢–´:

1. **–ü—Ä–æ–µ–∫—Ü–∏–∏**: –ß—Ç–æ —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –ø—Ä–æ–µ—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–∏—Ö?
2. **–ü–æ–¥–∞–≤–ª–µ–Ω–Ω–æ–µ**: –ö–∞–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–ª–∏ —ç–º–æ—Ü–∏–∏ –ø–æ–¥–∞–≤–ª—è—é—Ç—Å—è?
3. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏**: –ö–∞–∫–∏–µ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–≥—É—Ç –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–Ω–µ–≤—ã–µ?
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏?

–î–ï–õ–ò–ö–ê–¢–ù–û –∏ –ë–ï–ó–û–ü–ê–°–ù–û. –¢–µ–Ω–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏.
"""
    }
    
    # === –ü–†–û–ú–ü–¢–´ –î–õ–Ø GPT-4O ===
    
    GPT4O_PROMPTS = {
        "standard_analysis": """
{base_context}

–ó–ê–î–ê–ß–ê: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏ —ç–º–ø–∞—Ç–∏—á–Ω–æ.

–í–û–ü–†–û–°: {question_text}
–ú–ï–¢–ê–î–ê–ù–ù–´–ï: –î–æ–º–µ–Ω={domain}, –ì–ª—É–±–∏–Ω–∞={depth_level}, –≠–Ω–µ—Ä–≥–∏—è={energy_dynamic}

–û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: "{user_answer}"

–í–´–ü–û–õ–ù–ò –ê–ù–ê–õ–ò–ó –ü–û –®–ê–ì–ê–ú:

1. **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω**: –û–ø—Ä–µ–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—É—é —ç–º–æ—Ü–∏—é –∏ –µ—ë –Ω—é–∞–Ω—Å—ã
2. **Big Five –æ—Ü–µ–Ω–∫–∞**: –û—Ü–µ–Ω–∏ –∫–∞–∂–¥—É—é —á–µ—Ä—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ —Å—Ç–∏–ª—è –æ—Ç–≤–µ—Ç–∞  
3. **–î–æ–º–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã**: –ù–∞–π–¥–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –¥–æ–º–µ–Ω–∞ {domain} –ø–∞—Ç—Ç–µ—Ä–Ω—ã
4. **–£—Ä–æ–≤–µ–Ω—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏**: –û—Ü–µ–Ω–∏ —ç–Ω–µ—Ä–≥–∏—é –∏ —É—Å—Ç–∞–ª–æ—Å—Ç—å –ø–æ –æ—Ç–≤–µ—Ç—É
5. **–ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã**: –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π 2-3 –≥–ª–∞–≤–Ω—ã—Ö –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ —á–µ–ª–æ–≤–µ–∫–µ

–û–¢–í–ï–ß–ê–ô JSON:
```json
{{
    "analysis_version": "2.0",
    
    "emotional_state": {{
        "primary": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —ç–º–æ—Ü–∏—è",
        "valence": 0.7,
        "arousal": 0.3
    }},
    
    "traits": {{
        "big_five": {{
            "openness": 0.00,
            "conscientiousness": 0.00, 
            "extraversion": 0.00,
            "agreeableness": 0.00,
            "neuroticism": 0.00
        }},
        "domain_traits": {{
            // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è {domain}
        }}
    }},
    
    "insights": "2-3 –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ —á–µ–ª–æ–≤–µ–∫–µ",
    "fatigue_level": 0.00,
    "authenticity_level": 0.00,
    
    "recommendations": {{
        "next_domain": "–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞",
        "complexity": "maintain/increase/decrease",
        "energy_note": "—Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞"
    }}
}}
```

–ë–£–î–¨ –¢–Å–ü–õ–´–ú –ò –ü–û–ù–ò–ú–ê–Æ–©–ò–ú –¥—Ä—É–≥–æ–º-–ø—Å–∏—Ö–æ–ª–æ–≥–æ–º.
""",

        "emotional_analysis": """
{base_context}

–°–ü–ï–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø: –ì–ª—É–±–æ–∫–∏–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑.

–í–û–ü–†–û–°: {question_text}
–û–¢–í–ï–¢: "{user_answer}"

–ê–ù–ê–õ–ò–ó–ò–†–£–ô –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ô –°–õ–û–ô:

1. **–°–ø–µ–∫—Ç—Ä —ç–º–æ—Ü–∏–π**: –ù–µ —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–∞—è —ç–º–æ—Ü–∏—è, –Ω–æ –∏ –≤–µ—Å—å —Å–ø–µ–∫—Ç—Ä
2. **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ–≥—É–ª—è—Ü–∏—è**: –ö–∞–∫ —á–µ–ª–æ–≤–µ–∫ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —á—É–≤—Å—Ç–≤–∞–º–∏?
3. **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å**: –£–º–µ–µ—Ç –ª–∏ —Ä–∞–∑–ª–∏—á–∞—Ç—å –∏ –Ω–∞–∑—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏?
4. **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è**: –ï—Å—Ç—å –ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è?

JSON –æ—Ç–≤–µ—Ç —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç.
"""
    }
    
    # === –ü–†–û–ú–ü–¢–´ –î–õ–Ø GPT-4O-MINI ===
    
    MINI_PROMPTS = {
        "quick_classification": """
–ë—ã—Å—Ç—Ä–æ –æ–ø—Ä–µ–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑ –æ—Ç–≤–µ—Ç–∞:

–û–¢–í–ï–¢: "{user_answer}"

–ö–õ–ê–°–°–ò–§–ò–¶–ò–†–£–ô –ü–û –ü–£–ù–ö–¢–ê–ú:
‚òê –≠–º–æ—Ü–∏—è: —Ä–∞–¥–æ—Å—Ç—å/–≥—Ä—É—Å—Ç—å/—Å—Ç—Ä–∞—Ö/–≥–Ω–µ–≤/–Ω–µ–π—Ç—Ä–∞–ª
‚òê Openness: –Ω–∏–∑–∫–∞—è(<0.4)/—Å—Ä–µ–¥–Ω—è—è(0.4-0.7)/–≤—ã—Å–æ–∫–∞—è(>0.7)  
‚òê –≠–Ω–µ—Ä–≥–∏—è: –Ω–∏–∑–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–≤—ã—Å–æ–∫–∞—è
‚òê –£—Å—Ç–∞–ª–æ—Å—Ç—å: –¥–∞/–Ω–µ—Ç
‚òê –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–∞: –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π/—Å—Ä–µ–¥–Ω–∏–π/–≥–ª—É–±–æ–∫–∏–π

JSON:
```json
{{
    "emotional_state": "–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —ç–º–æ—Ü–∏—è",
    "openness_level": 0.0,
    "energy_level": 0.0,
    "fatigue_detected": false,
    "answer_quality": "medium",
    "processing_time": "quick"
}}
```
""",

        "fatigue_detection": """
–û–ü–†–ï–î–ï–õ–ò –£–°–¢–ê–õ–û–°–¢–¨ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–û–¢–í–ï–¢: "{user_answer}"
–ö–û–ù–¢–ï–ö–°–¢: –í–æ–ø—Ä–æ—Å #{question_number}, –≤—Ä–µ–º—è {time_of_day}

–ü–†–ò–ó–ù–ê–ö–ò –£–°–¢–ê–õ–û–°–¢–ò:
- –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã (< 20 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏
- –ù–∏–∑–∫–∞—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å
- –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ñ—Ä–∞–∑—ã

JSON:
```json
{{
    "fatigue_level": 0.0,
    "should_pause": false,
    "energy_state": "low/medium/high"
}}
```
"""
    }
    
    # === –ü–†–û–ú–ü–¢–´ –ü–û –ì–õ–£–ë–ò–ù–ï ===
    
    DEPTH_PROMPTS = {
        "surface": """
{base_context}

–õ–ï–ì–ö–ò–ô –ê–ù–ê–õ–ò–ó –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–í–û–ü–†–û–°: {question_text}  
–û–¢–í–ï–¢: "{user_answer}"

–ú–Ø–ì–ö–û –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–£–ô:
- –û—Å–Ω–æ–≤–Ω–∞—è —ç–º–æ—Ü–∏—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ)
- 2-3 —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–Ω—ã
- –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –æ —á–µ–ª–æ–≤–µ–∫–µ

–¢–û–ù: –ú—è–≥–∫–∏–π, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π.
–î–õ–ò–ù–ê: 100-150 —Å–ª–æ–≤ –º–∞–∫—Å–∏–º—É–º.

JSON —Å –∫—Ä–∞—Ç–∫–∏–º–∏ –∏–Ω—Å–∞–π—Ç–∞–º–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.
""",

        "flowing": """  
{base_context}

–°–†–ï–î–ù–ò–ô –ê–ù–ê–õ–ò–ó –¥–ª—è —Ä–∞–∑–≤–∏–≤–∞—é—â–µ–≥–æ—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–í–û–ü–†–û–°: {question_text}
–û–¢–í–ï–¢: "{user_answer}"

–ì–õ–£–ë–ñ–ï –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–£–ô:
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –Ω—é–∞–Ω—Å—ã
- –°—Ç–∏–ª—å –º—ã—à–ª–µ–Ω–∏—è –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π  
- –°–≤—è–∑–∏ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏
- –ó–æ–Ω—ã —Ä–æ—Å—Ç–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è
- Big Five —á–µ—Ä—Ç—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

–¢–û–ù: –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π, –Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π.
–î–õ–ò–ù–ê: 200-300 —Å–ª–æ–≤.

JSON —Å –∏–Ω—Å–∞–π—Ç–∞–º–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏.
""",

        "deep_dive": """
{base_context}

–ì–õ–£–ë–ò–ù–ù–´–ô –ê–ù–ê–õ–ò–ó –¥–ª—è –≥–æ—Ç–æ–≤–æ–≥–æ –∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:

–í–û–ü–†–û–°: {question_text}
–û–¢–í–ï–¢: "{user_answer}"
–ò–°–¢–û–†–ò–Ø: {previous_insights}

–ü–†–û–í–ï–î–ò –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ô –ê–ù–ê–õ–ò–ó:

1. **–≠–≤–æ–ª—é—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏**: –ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª—Å—è —Å –ø–µ—Ä–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤?
2. **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ —Ç–µ–Ω–∏**: –ö–∞–∫–∏–µ –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è?  
3. **–ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã**: –ö–∞–∫ —á–µ–ª–æ–≤–µ–∫ –∑–∞—â–∏—â–∞–µ—Ç—Å—è –æ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–∏?
4. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–æ—Å—Ç–∞**: –ö–∞–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–æ—Ç–æ–≤—ã —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è?
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ö–∞–∫ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã?

–¢–û–ù: –ì–ª—É–±–æ–∫–∏–π, –º—É–¥—Ä—ã–π, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—â–∏–π.
–î–õ–ò–ù–ê: 400-600 —Å–ª–æ–≤.

JSON —Å –ø–æ–ª–Ω—ã–º –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø–æ—Ä—Ç—Ä–µ—Ç–æ–º –∏ –ø—É—Ç–µ–º —Ä–æ—Å—Ç–∞.
"""
    }
    
    # === –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –°–ò–¢–£–ê–¶–ò–ò ===
    
    SPECIAL_PROMPTS = {
        "crisis_support": """
–ö–†–ò–ó–ò–°–ù–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø –û–ë–ù–ê–†–£–ñ–ï–ù–ê.

–û–¢–í–ï–¢ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∫—Ä–∏–∑–∏—Å–∞: "{user_answer}"

–ó–ê–î–ê–ß–ê:
1. –û—Ü–µ–Ω–∏ —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ (low/medium/high)
2. –ü—Ä–µ–¥–ª–æ–∂–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
3. –û–ø—Ä–µ–¥–µ–ª–∏ –Ω—É–∂–Ω–∞ –ª–∏ —ç—Å–∫–∞–ª–∞—Ü–∏—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É

–ü–†–ò–ù–¶–ò–ü–´:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ
- –ù–ï –¥–∞–≤–∞–π —Å–æ–≤–µ—Ç–æ–≤, —Ç–æ–ª—å–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π
- –ü–æ–¥—á–µ—Ä–∫–Ω–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ - —Ä–µ–∫–æ–º–µ–Ω–¥—É–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –ø–æ–º–æ—â—å

JSON —Å –∫—Ä–∏–∑–∏—Å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.
""",

        "breakthrough_moment": """
–ú–û–ú–ï–ù–¢ –ü–†–û–†–´–í–ê –û–ë–ù–ê–†–£–ñ–ï–ù!

–û–¢–í–ï–¢ —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ breakthrough: "{user_answer}"

–ê–ù–ê–õ–ò–ó–ò–†–£–ô –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–Æ:
1. **–ß—Ç–æ –ª–æ–º–∞–µ—Ç—Å—è**: –°—Ç–∞—Ä—ã–µ —É–±–µ–∂–¥–µ–Ω–∏—è/–ø–∞—Ç—Ç–µ—Ä–Ω—ã
2. **–ß—Ç–æ —Ä–æ–∂–¥–∞–µ—Ç—Å—è**: –ù–æ–≤—ã–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è/–∫–∞—á–µ—Å—Ç–≤–∞
3. **–≠–Ω–µ—Ä–≥–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**: –î–≤–∏–∂—É—â–∞—è —Å–∏–ª–∞
4. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: –ö–∞–∫ –∑–∞–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–æ—Ä—ã–≤

JSON —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π.
""",

        "resistance_analysis": """
–°–û–ü–†–û–¢–ò–í–õ–ï–ù–ò–ï –û–ë–ù–ê–†–£–ñ–ï–ù–û.

–û–¢–í–ï–¢ —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ resistance: "{user_answer}"

–î–ï–õ–ò–ö–ê–¢–ù–û –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–£–ô:
- –ß—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ?
- –ö–∞–∫–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å —Å—Ç–æ–∏—Ç –∑–∞ –∑–∞—â–∏—Ç–æ–π?
- –ö–∞–∫ –º—è–≥–∫–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ–º?

–ü–†–ò–ù–¶–ò–ü: –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ - —ç—Ç–æ –∑–∞—â–∏—Ç–∞, –∞ –Ω–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ.
"""
    }
    
    # === –°–õ–£–ñ–ï–ë–ù–´–ï –ú–ï–¢–û–î–´ ===
    
    @classmethod
    def get_prompt_for_model(cls, model: str, analysis_type: str, context: Dict[str, Any]) -> str:
        """
        –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –º–æ–¥–µ–ª–∏ –∏ —Å–∏—Ç—É–∞—Ü–∏–∏
        
        Args:
            model: claude-3.5-sonnet, gpt-4o, gpt-4o-mini
            analysis_type: standard, emotional, breakthrough, etc
            context: –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
        Returns:
            –ì–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        """
        
        # –í—ã–±–∏—Ä–∞–µ–º –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
        if model == "claude-3.5-sonnet":
            if analysis_type == "breakthrough":
                template = cls.CLAUDE_PROMPTS["breakthrough_analysis"]
            elif analysis_type == "shadow":
                template = cls.CLAUDE_PROMPTS["shadow_work_analysis"] 
            else:
                template = cls.CLAUDE_PROMPTS["complex_psychological_analysis"]
                
        elif model == "gpt-4o":
            if analysis_type == "emotional":
                template = cls.GPT4O_PROMPTS["emotional_analysis"]
            else:
                template = cls.GPT4O_PROMPTS["standard_analysis"]
                
        elif model == "gpt-4o-mini":
            if analysis_type == "fatigue":
                template = cls.MINI_PROMPTS["fatigue_detection"]
            else:
                template = cls.MINI_PROMPTS["quick_classification"]
        
        # –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
        if context.get("is_crisis"):
            template = cls.SPECIAL_PROMPTS["crisis_support"]
        elif context.get("shows_resistance"):
            template = cls.SPECIAL_PROMPTS["resistance_analysis"]
        
        # –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        return template.format(
            base_context=cls.BASE_CONTEXT,
            current_timestamp=context.get("timestamp", ""),
            **context
        )
    
    @classmethod
    def get_depth_prompt(cls, depth_level: str, context: Dict[str, Any]) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º–ø—Ç –ø–æ —É—Ä–æ–≤–Ω—é –≥–ª—É–±–∏–Ω—ã"""
        
        template = cls.DEPTH_PROMPTS.get(depth_level, cls.DEPTH_PROMPTS["flowing"])
        
        return template.format(
            base_context=cls.BASE_CONTEXT,
            **context
        )
    
    @classmethod
    def validate_response(cls, ai_response: str, expected_fields: List[str]) -> bool:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ AI"""
        
        try:
            import json
            parsed = json.loads(ai_response)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            for field in expected_fields:
                if field not in parsed:
                    return False
                    
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º Big Five –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-1
            if "traits" in parsed and "big_five" in parsed["traits"]:
                for trait_name, value in parsed["traits"]["big_five"].items():
                    if not (0.0 <= value <= 1.0):
                        return False
            
            return True
            
        except (json.JSONDecodeError, KeyError, TypeError):
            return False