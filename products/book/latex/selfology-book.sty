% selfology-book.sty
% Стили для книг Selfology
% v2.0 — December 2024

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{selfology-book}[2024/12/01 Selfology Book Styles]

% ============================================
% GEOMETRY - Premium Margins
% ============================================
\RequirePackage[
  a4paper,
  inner=20mm,
  outer=25mm,
  top=20mm,
  bottom=25mm,
  headheight=14pt,
  headsep=20pt,
  footskip=30pt
]{geometry}

% ============================================
% FONTS - Montserrat + IBM Plex Sans
% ============================================
\RequirePackage{fontspec}

\setmainfont{IBM Plex Sans}[Scale=1.0]

\setsansfont{Montserrat}[
  Path = /home/ksnk/.local/share/fonts/,
  Extension = .ttf,
  UprightFont = *-Regular,
  BoldFont = *-SemiBold,
  ItalicFont = *-Italic,
  Scale = 1.0
]

% ============================================
% LANGUAGE
% ============================================
\RequirePackage{polyglossia}
\setdefaultlanguage{russian}

% ============================================
% PACKAGES
% ============================================
\RequirePackage{xcolor}
\RequirePackage{titlesec}
\RequirePackage{fancyhdr}
\RequirePackage{needspace}
\RequirePackage{tikz}
\RequirePackage{microtype}
\RequirePackage{ragged2e}

% ============================================
% COLORS
% ============================================
\definecolor{primary}{HTML}{282828}
\definecolor{secondary}{HTML}{666666}
\definecolor{linegray}{HTML}{D0D0D0}

\color{primary}

% ============================================
% TYPOGRAPHY
% ============================================
\RaggedRight
\setlength{\parindent}{0pt}
\setlength{\parskip}{1em}

% Переносы слов - ЗАПРЕЩЕНЫ полностью
\hyphenpenalty=10000
\exhyphenpenalty=10000

% Разрешаем растягивать пробелы в крайнем случае (вместо вылета за поля)
\emergencystretch=5em

% Запрет висячих строк
\widowpenalty=10000
\clubpenalty=10000

% ============================================
% COVER PAGE
% ============================================

% Команда для обложки книги
% Использование: \bookcover{Название}{Подзаголовок}{Год}
\newcommand{\bookcover}[3]{%
  \thispagestyle{empty}%
  \begin{tikzpicture}[remember picture,overlay]
    % Минималистичный дизайн — только типографика
  \end{tikzpicture}%
  \vspace*{0.25\textheight}%
  \begin{center}%
    {\sffamily\bfseries\fontsize{42pt}{50pt}\selectfont\color{primary}#1}%
    \par\vspace{1.5em}%
    {\sffamily\fontsize{16pt}{22pt}\selectfont\color{secondary}#2}%
    \par\vspace{0.4\textheight}%
    {\sffamily\fontsize{14pt}{18pt}\selectfont\color{secondary}Selfology}%
    \par\vspace{0.5em}%
    {\sffamily\fontsize{11pt}{14pt}\selectfont\color{linegray}#3}%
  \end{center}%
  \newpage%
  \setcounter{page}{1}%  % Сброс нумерации после обложки
}

% ============================================
% TABLE OF CONTENTS
% ============================================
\RequirePackage{tocloft}

% Стиль оглавления
\renewcommand{\cfttoctitlefont}{\sffamily\bfseries\fontsize{24pt}{28pt}\selectfont\color{primary}}
\renewcommand{\cftchapfont}{\sffamily\color{primary}}
\renewcommand{\cftchappagefont}{\sffamily\color{secondary}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftsecdotsep}}
\renewcommand{\cftchapafterpnum}{\vspace{0.3em}}

% Убираем "Глава" перед названием
\renewcommand{\cftchappresnum}{}
\renewcommand{\cftchapnumwidth}{0pt}

% Команда для оглавления с заголовком
\newcommand{\booktoc}{%
  \clearpage%
  \thispagestyle{empty}%
  \tableofcontents%
  \clearpage%
  \markboth{}{}%  % Очищаем колонтитул после оглавления
}

% ============================================
% HEADERS - Typographic Hierarchy
% ============================================

% Chapter = Program (28pt) — на отдельной странице
% raggedright позволяет переносить длинные заголовки на 2+ строки
\titleformat{\chapter}[block]
  {\thispagestyle{empty}\vspace*{0.3\textheight}\raggedright\sffamily\bfseries\fontsize{28pt}{34pt}\selectfont\color{primary}}
  {}
  {0pt}
  {}
\titlespacing*{\chapter}{0pt}{0pt}{2em}

\setcounter{secnumdepth}{-1}

% После заголовка программы — новая страница
\newcommand{\programbreak}{\newpage}

% Кластер: каждый с новой страницы, только название и описание
\newcommand{\cluster}[3]{%
  \newpage%
  \vspace*{1.5em}%
  \noindent%
  {\sffamily\bfseries\fontsize{16pt}{20pt}\selectfont\color{primary}#1}%
  \par\vspace{0.3em}%
  {\itshape\color{secondary}#3}%
  \par\vspace{0.8em}%
}

% ============================================
% BOOK 2: Parts & Clusters with Program
% ============================================

% Part: большой заголовок части (для Book 2)
\renewcommand{\part}[1]{%
  \clearpage%
  \thispagestyle{empty}%
  \addcontentsline{toc}{chapter}{#1}%  % Добавляем в оглавление
  \markboth{#1}{#1}%                    % Обновляем колонтитул
  \vspace*{0.25\textheight}%
  \begin{center}%
    {\sffamily\bfseries\fontsize{36pt}{42pt}\selectfont\color{primary}#1}%
  \end{center}%
}

% Подзаголовок части
\newcommand{\partsubtitle}[1]{%
  \vspace{1em}%
  \begin{center}%
    {\sffamily\fontsize{14pt}{18pt}\selectfont\color{secondary}#1}%
  \end{center}%
}

% Кластер с указанием программы (для Book 2)
\newcommand{\clusterWithProgram}[4]{%
  \newpage%
  \vspace*{1.5em}%
  \noindent%
  {\sffamily\bfseries\fontsize{16pt}{20pt}\selectfont\color{primary}#1}%
  \hfill%
  {\small\sffamily\color{secondary}#4}%
  \par\vspace{0.3em}%
  {\itshape\color{secondary}#3}%
  \par\vspace{0.8em}%
}

% ============================================
% RUNNING HEADERS & FOOTERS
% ============================================
\pagestyle{fancy}
\fancyhf{}

\renewcommand{\chaptermark}[1]{\markboth{#1}{#1}}

% Название программы вверху справа
\fancyhead[R]{\small\sffamily\color{secondary}\leftmark}

% Номер страницы вверху слева
\fancyhead[L]{\small\sffamily\color{secondary}\thepage}

% ksnk в левом нижнем углу
\fancyfoot[L]{\small\sffamily\color{linegray}ksnk}

\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\fancypagestyle{plain}{
  \fancyhf{}
  \fancyhead[L]{\small\sffamily\color{secondary}\thepage}
  \fancyfoot[L]{\small\sffamily\color{linegray}ksnk}
}

% ============================================
% QUESTIONS - Только вопрос + воздух для размышлений
% ============================================

% Foundation: лёгкие вопросы
\newcommand{\questionF}[1]{%
  \needspace{3\baselineskip}%
  \par\noindent\textbf{#1}%
  \par\vspace{1.5em}%
}

% Exploration: глубже
\newcommand{\questionE}[1]{%
  \needspace{3\baselineskip}%
  \par\noindent\textbf{#1}%
  \par\vspace{2em}%
}

% Integration: самые глубокие
\newcommand{\questionI}[1]{%
  \needspace{3\baselineskip}%
  \par\noindent\textbf{#1}%
  \par\vspace{2.5em}%
}

\endinput
