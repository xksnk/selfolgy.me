# ROADMAP: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–ª–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–≥—Ä–∞–º–º

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–¶–µ–ª—å:** –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –æ—Ç —Ö–∞–æ—Ç–∏—á–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º —Å –±–ª–æ–∫–∞–º–∏.

**–ú–∞—Å—à—Ç–∞–±:** ~1000-1200 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞, 5 –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –ë–î, –Ω–æ–≤—ã–π JSON —Ñ–æ—Ä–º–∞—Ç.

---

## –§–ê–ó–ê 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### 0.1 –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã ‚úÖ
- [x] –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [x] –ö–∞—Ä—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- [x] –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (17 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- [x] –°—Ö–µ–º–∞ —Ç–µ–∫—É—â–∏—Ö —Ç–∞–±–ª–∏—Ü –ë–î

### 0.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- [x] 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è: –ü—Ä–æ–≥—Ä–∞–º–º–∞ ‚Üí –ë–ª–æ–∫ ‚Üí –í–æ–ø—Ä–æ—Å
- [x] 9 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (—É–±—Ä–∞—Ç—å 2: insight_potential, batch_compatible)
- [x] –¢–∏–ø—ã –±–ª–æ–∫–æ–≤: Foundation / Exploration / Integration
- [x] –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: –±–ª–æ–∫ ‚Üí –≤–æ–ø—Ä–æ—Å—ã

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|-----------|------|-----------|
| Question Core | `intelligent_question_core/` | –ù–æ–≤—ã–π JSON —Ñ–æ—Ä–º–∞—Ç |
| QuestionRouter | `services/onboarding/question_router.py` | –ë–ª–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ |
| Orchestrator | `services/onboarding/orchestrator.py` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ |
| OnboardingDAO | `database/onboarding_dao.py` | –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã |
| AnswerAnalyzer | `analysis/answer_analyzer.py` | program_context |
| FatigueDetector | `services/onboarding/fatigue_detector.py` | –ü–æ—Ä–æ–≥–∏ –ø–æ –±–ª–æ–∫–∞–º |
| EmbeddingCreator | `analysis/embedding_creator.py` | program_id –≤ –≤–µ–∫—Ç–æ—Ä–∞—Ö |

---

## –§–ê–ó–ê 1: –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### 1.1 –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∞
**–í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:** `research/–¢—ã –º–µ—Ç–æ–¥–æ–ª–æ–≥ –ø–æ –¥–∏–∑–∞–π–Ω—É —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–Ω–∏–∫–æ–≤..md`

**–ó–∞–¥–∞—á–∏:**
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—Å–µ—Ä markdown ‚Üí JSON
- [ ] –ò–∑–≤–ª–µ—á—å –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã (38 —à—Ç)
- [ ] –ò–∑–≤–ª–µ—á—å –±–ª–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º
- [ ] –ò–∑–≤–ª–µ—á—å –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∫–∏ üìñ/ü§ñ

**–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç:**
```json
{
  "programs": [
    {
      "id": "program_life_reflection",
      "name": "–ü–æ–¥—É–º–∞—Ç—å –æ –∂–∏–∑–Ω–∏",
      "description": "–ì–ª—É–±–æ–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Å–º—ã—Å–ª–µ...",
      "status": "ready",
      "priority": 0,
      "estimated_duration_min": 30,
      "blocks": [
        {
          "id": "block_1",
          "name": "–ó–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å",
          "type": "Foundation",
          "sequence": 1,
          "block_metadata": {
            "base_journey_stage": "ENTRY",
            "base_depth_range": ["SURFACE", "CONSCIOUS"],
            "base_energy_dynamic": "OPENING",
            "base_safety_minimum": 4
          },
          "questions": [
            {
              "id": "q_life_b1_q1",
              "position": 1,
              "text": "–û–ø–∏—à–∏ —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å —Ç—Ä–µ–º—è —Å–ª–æ–≤–∞–º–∏",
              "format": "ai_only"
            }
          ]
        }
      ]
    }
  ]
}
```

### 1.2 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
**–ó–∞–¥–∞—á–∏:**
- [ ] –ü—Ä–∞–≤–∏–ª–∞ –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –≤ –±–ª–æ–∫–µ (complexity, energy_dynamic)
- [ ] AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (emotional_weight, safety_level)
- [ ] –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç block_metadata
- [ ] –í—ã—á–∏—Å–ª–µ–Ω–∏–µ domain –∏–∑ —Ç–µ–∫—Å—Ç–∞ (embedding)
- [ ] –§–ª–∞–≥ needs_human_review –¥–ª—è confidence < 0.75

### 1.3 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Question Core
**–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:** `intelligent_question_core/data/selfology_programs_v2.json`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "version": "2.0",
  "generated_at": "2024-11-29T12:00:00Z",
  "metadata": {
    "total_programs": 38,
    "total_blocks": 200,
    "total_questions": 500
  },
  "programs": [...],
  "indexes": {
    "by_program": {},
    "by_block": {},
    "by_domain": {},
    "by_depth": {}
  }
}
```

---

## –§–ê–ó–ê 2: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 2.1 –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ü—Ä–æ–≥—Ä–∞–º–º—ã
CREATE TABLE selfology.onboarding_programs (
  id SERIAL PRIMARY KEY,
  program_id VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  status VARCHAR(20) DEFAULT 'active',
  priority INTEGER DEFAULT 0,
  estimated_duration_min INTEGER,
  therapeutic_approach TEXT[],
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- –ë–ª–æ–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º
CREATE TABLE selfology.program_blocks (
  id SERIAL PRIMARY KEY,
  block_id VARCHAR(50) UNIQUE NOT NULL,
  program_id VARCHAR(50) REFERENCES selfology.onboarding_programs(program_id),
  name VARCHAR(100) NOT NULL,
  block_type VARCHAR(20) NOT NULL, -- Foundation, Exploration, Integration
  sequence INTEGER NOT NULL,
  base_journey_stage VARCHAR(20),
  base_depth_range VARCHAR(50),
  base_energy_dynamic VARCHAR(20),
  base_safety_minimum INTEGER,
  estimated_duration_min INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–≥—Ä–∞–º–º (—Å–≤—è–∑—å —Å JSON)
CREATE TABLE selfology.program_questions (
  id SERIAL PRIMARY KEY,
  question_id VARCHAR(50) UNIQUE NOT NULL,
  block_id VARCHAR(50) REFERENCES selfology.program_blocks(block_id),
  program_id VARCHAR(50) REFERENCES selfology.onboarding_programs(program_id),
  position INTEGER NOT NULL,
  text TEXT NOT NULL,
  format VARCHAR(20), -- book_only, ai_only, both
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è)
  journey_stage VARCHAR(20),
  depth_level VARCHAR(20),
  domain VARCHAR(30),
  energy_dynamic VARCHAR(20),
  complexity INTEGER,
  emotional_weight INTEGER,
  safety_level INTEGER,
  trust_requirement INTEGER,
  recommended_model VARCHAR(30),
  requires_context BOOLEAN,
  -- –í–∞–ª–∏–¥–∞—Ü–∏—è
  confidence_score FLOAT,
  needs_human_review BOOLEAN DEFAULT false,
  reviewed_by VARCHAR(50),
  reviewed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º
CREATE TABLE selfology.user_program_progress (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL,
  program_id VARCHAR(50) REFERENCES selfology.onboarding_programs(program_id),
  session_id INTEGER REFERENCES selfology.onboarding_sessions(id),
  current_block_id VARCHAR(50),
  blocks_completed VARCHAR(50)[],
  blocks_skipped VARCHAR(50)[],
  questions_answered INTEGER DEFAULT 0,
  completion_percentage INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active', -- active, completed, paused, abandoned
  started_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP,
  updated_at TIMESTAMP DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_blocks_program ON selfology.program_blocks(program_id);
CREATE INDEX idx_questions_block ON selfology.program_questions(block_id);
CREATE INDEX idx_questions_program ON selfology.program_questions(program_id);
CREATE INDEX idx_progress_user ON selfology.user_program_progress(user_id);
CREATE INDEX idx_progress_session ON selfology.user_program_progress(session_id);
```

### 2.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤ onboarding_sessions
ALTER TABLE selfology.onboarding_sessions
ADD COLUMN current_program_id VARCHAR(50),
ADD COLUMN current_block_id VARCHAR(50),
ADD COLUMN program_progress_id INTEGER;

-- –î–æ–±–∞–≤–∏—Ç—å –≤ questions_metadata (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
ALTER TABLE selfology.questions_metadata
ADD COLUMN program_id VARCHAR(50),
ADD COLUMN block_id VARCHAR(50),
ADD COLUMN position_in_block INTEGER;
```

### 2.3 –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `scripts/migrations/001_programs_structure.sql`
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ –∫–æ–ø–∏–∏ –ë–î
- [ ] Rollback —Å–∫—Ä–∏–ø—Ç

---

## –§–ê–ó–ê 3: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### 3.1 –ü—Ä–∞–≤–∏–ª–∞ –ø–æ –ø–æ–∑–∏—Ü–∏–∏
**–§–∞–π–ª:** `intelligent_question_core/metadata_generator.py`

```python
POSITION_RULES = {
    "Foundation": {
        1: {"complexity": 1, "emotional_weight": 1, "energy_dynamic": "OPENING"},
        2: {"complexity": 2, "emotional_weight": 1, "energy_dynamic": "OPENING"},
        3: {"complexity": 2, "emotional_weight": 2, "energy_dynamic": "NEUTRAL"},
    },
    "Exploration": {
        1: {"complexity": 2, "emotional_weight": 2, "energy_dynamic": "NEUTRAL"},
        2: {"complexity": 3, "emotional_weight": 3, "energy_dynamic": "PROCESSING"},
        3: {"complexity": 3, "emotional_weight": 3, "energy_dynamic": "PROCESSING"},
        4: {"complexity": 4, "emotional_weight": 4, "energy_dynamic": "HEAVY"},
        5: {"complexity": 4, "emotional_weight": 4, "energy_dynamic": "HEAVY"},
        6: {"complexity": 3, "emotional_weight": 3, "energy_dynamic": "HEALING"},
    },
    "Integration": {
        1: {"complexity": 4, "emotional_weight": 3, "energy_dynamic": "PROCESSING"},
        2: {"complexity": 4, "emotional_weight": 3, "energy_dynamic": "HEALING"},
        3: {"complexity": 3, "emotional_weight": 2, "energy_dynamic": "HEALING"},
    }
}
```

### 3.2 AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
**–ü—Ä–æ–º–ø—Ç –¥–ª—è Claude:**
- –ê–Ω–∞–ª–∏–∑ emotional_weight –ø–æ —Ç–µ–∫—Å—Ç—É
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ safety_level
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ domain
- Confidence score

### 3.3 –§–∏–Ω–∞–ª—å–Ω—ã–π pipeline
```
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ–ø—Ä–æ—Å + –±–ª–æ–∫
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–∑–∏—Ü–∏–∏ ‚Üí –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
3. –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç block_metadata
4. –ï—Å–ª–∏ confidence < 0.75 ‚Üí AI –∞–Ω–∞–ª–∏–∑
5. –í—ã—á–∏—Å–ª–∏—Ç—å domain (embedding)
6. –ü–æ–º–µ—Ç–∏—Ç—å needs_human_review –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å final_metadata
```

---

## –§–ê–ó–ê 4: –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ Question Router

### 4.1 –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞
**–§–∞–π–ª:** `selfology_bot/services/onboarding/question_router.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å `ProgramContext` dataclass
- [ ] –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `select_question_from_block()`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ `can_proceed_to_next_block()`
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Foundation ‚Üí Exploration ‚Üí Integration
- [ ] Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –¥–ª—è legacy —Å–µ—Å—Å–∏–π

### 4.2 –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

```python
class QuestionRouter:
    async def select_first_question_in_program(
        self, user_id: int, program_id: str
    ) -> Optional[Dict]:
        """–ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã"""

    async def select_next_question_in_block(
        self, user_id: int, program_context: ProgramContext
    ) -> Optional[Dict]:
        """–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ–∫—É—â–µ–º –±–ª–æ–∫–µ"""

    async def can_proceed_to_next_block(
        self, user_id: int, program_context: ProgramContext
    ) -> bool:
        """–ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É"""

    async def get_next_block(
        self, program_context: ProgramContext
    ) -> Optional[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ (—Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞)"""
```

### 4.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–æ–π
- Smart Mix —Ä–∞–±–æ—Ç–∞–µ—Ç –í–ù–£–¢–†–ò –±–ª–æ–∫–∞
- –ú–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ ‚Äî —Å—Ç—Ä–æ–≥–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Foundation –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–µ—Ä–µ–¥ Exploration

---

## –§–ê–ó–ê 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Orchestrator

### 5.1 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏
**–§–∞–π–ª:** `selfology_bot/services/onboarding/orchestrator.py`

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
```python
async def start_program(self, user_id: int, program_id: str) -> Dict:
    """–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É"""

async def get_program_progress(self, user_id: int, program_id: str) -> Dict:
    """–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ"""

async def complete_block(self, user_id: int, block_id: str) -> Dict:
    """–ó–∞–≤–µ—Ä—à–∏—Ç—å –±–ª–æ–∫, –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É"""

async def pause_program(self, user_id: int) -> Dict:
    """–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É"""

async def resume_program(self, user_id: int) -> Dict:
    """–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É"""
```

### 5.2 –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ process_user_answer
- –û–±–Ω–æ–≤–ª—è—Ç—å `program_progress`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–ª–æ–∫–∞
- –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É

### 5.3 –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ get_next_question
- –£—á–∏—Ç—ã–≤–∞—Ç—å `current_block_id`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `blocks_completed`
- –í—ã–∑—ã–≤–∞—Ç—å `question_router.select_next_question_in_block()`

---

## –§–ê–ó–ê 6: –≠–∫—Å–ø–æ—Ä—Ç –≤ –∫–Ω–∏–≥—É/PDF

### 6.1 –°–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞
**–§–∞–π–ª:** `scripts/export_programs_book.py`

**–§–æ—Ä–º–∞—Ç—ã:**
- Markdown (–¥–ª—è —Ä–µ–≤—å—é)
- HTML (–¥–ª—è –≤–µ–±)
- PDF (–¥–ª—è –ø–µ—á–∞—Ç–∏)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–∏–≥–∏:**
```
# Selfology: –ö–Ω–∏–≥–∞ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

## –ü—Ä–æ–≥—Ä–∞–º–º–∞ 1: –ü–æ–¥—É–º–∞—Ç—å –æ –∂–∏–∑–Ω–∏

### –ß–∞—Å—Ç—å 1: –ó–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å

1. –û–ø–∏—à–∏ —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å —Ç—Ä–µ–º—è —Å–ª–æ–≤–∞–º–∏
   _______________________________________________

2. –ö–∞–∫ –æ–±—ã—á–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–≤–æ—ë —É—Ç—Ä–æ?
   _______________________________________________
   _______________________________________________

### –ß–∞—Å—Ç—å 2: –õ—é–¥–∏ —Ä—è–¥–æ–º
...
```

### 6.2 –û–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
- [ ] –¢–æ–ª—å–∫–æ üìñ –≤–æ–ø—Ä–æ—Å—ã (–¥–ª—è –∫–Ω–∏–≥–∏)
- [ ] –¢–æ–ª—å–∫–æ ü§ñ –≤–æ–ø—Ä–æ—Å—ã (–¥–ª—è AI)
- [ ] –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã (–ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
- [ ] –° –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- [ ] –ë–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

---

## –§–ê–ó–ê 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 7.1 Unit —Ç–µ—Å—Ç—ã
- [ ] –ü–∞—Ä—Å–µ—Ä markdown ‚Üí JSON
- [ ] –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- [ ] Question Router (–±–ª–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- [ ] Orchestrator (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏)

### 7.2 Integration —Ç–µ—Å—Ç—ã
- [ ] –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: start_program ‚Üí questions ‚Üí complete
- [ ] –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π

### 7.3 –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ emotional_weight –¥–ª—è sensitivity > 3
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ safety_level –¥–ª—è trauma –≤–æ–ø—Ä–æ—Å–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –±–ª–æ–∫–∞—Ö
- [ ] Approval –≤—Å–µ—Ö 38 –ø—Ä–æ–≥—Ä–∞–º–º

### 7.4 A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –±–ª–æ—á–Ω–∞—è vs random –ª–æ–≥–∏–∫–∞
- [ ] –ú–µ—Ç—Ä–∏–∫–∏: completion rate, engagement, insights

---

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

```
–§–ê–ó–ê 1 (–ü–∞—Ä—Å–∏–Ω–≥)
    ‚Üì
–§–ê–ó–ê 2 (–ë–î) ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚Üì                         ‚îÇ
–§–ê–ó–ê 3 (–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚Üì                         ‚îÇ
–§–ê–ó–ê 4 (Router) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚Üì                         ‚îÇ
–§–ê–ó–ê 5 (Orchestrator) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
–§–ê–ó–ê 6 (–≠–∫—Å–ø–æ—Ä—Ç) [–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å 4-5]
    ‚Üì
–§–ê–ó–ê 7 (–¢–µ—Å—Ç—ã) [–ø–æ—Å–ª–µ –≤—Å–µ–≥–æ]
```

---

## –û–¶–ï–ù–ö–ê –í–†–ï–ú–ï–ù–ò

| –§–∞–∑–∞ | –ó–∞–¥–∞—á–∏ | –û—Ü–µ–Ω–∫–∞ |
|------|--------|--------|
| 0 | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 1 | –ü–∞—Ä—Å–∏–Ω–≥ + —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | 2-3 —á–∞—Å–∞ |
| 2 | –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î | 1-2 —á–∞—Å–∞ |
| 3 | –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö | 2-3 —á–∞—Å–∞ |
| 4 | Question Router | 3-4 —á–∞—Å–∞ |
| 5 | Orchestrator | 2-3 —á–∞—Å–∞ |
| 6 | –≠–∫—Å–ø–æ—Ä—Ç –∫–Ω–∏–≥–∏ | 1-2 —á–∞—Å–∞ |
| 7 | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 2-3 —á–∞—Å–∞ |
| **–ò—Ç–æ–≥–æ** | | **13-20 —á–∞—Å–æ–≤** |

---

## ROLLBACK –ü–õ–ê–ù

–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º:
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ `backup/pre-programs-refactor-2024-11-29`
2. –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
3. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–π Question Core JSON

---

## –ú–û–ù–ò–¢–û–†–ò–ù–ì –ü–û–°–õ–ï –î–ï–ü–õ–û–Ø

- [ ] –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ Router
- [ ] Completion rate –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º
- [ ] –í—Ä–µ–º—è –Ω–∞ –±–ª–æ–∫ vs —Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞
- [ ] –§–∏–¥–±–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
