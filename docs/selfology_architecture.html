<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selfology Architecture - Complete System Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --accent: #e94560;
            --accent-secondary: #533483;
            --success: #4ade80;
            --warning: #fbbf24;
            --info: #60a5fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid var(--accent-secondary);
        }

        .sidebar h1 {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .sidebar .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .nav-link {
            display: block;
            padding: 10px 15px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .nav-link:hover {
            background: var(--bg-card);
            color: var(--accent);
        }

        .nav-link.active {
            background: var(--accent);
            color: white;
        }

        .nav-link .icon {
            margin-right: 10px;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 40px;
            flex: 1;
        }

        .section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid var(--accent-secondary);
        }

        .section h2 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .section .description {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        .diagram-container {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        /* Info boxes */
        .info-box {
            background: rgba(96, 165, 250, 0.1);
            border-left: 4px solid var(--info);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box {
            background: rgba(251, 191, 36, 0.1);
            border-left: 4px solid var(--warning);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .success-box {
            background: rgba(74, 222, 128, 0.1);
            border-left: 4px solid var(--success);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--accent-secondary);
        }

        th {
            background: var(--bg-card);
            color: var(--accent);
            font-weight: 600;
        }

        tr:hover {
            background: rgba(233, 69, 96, 0.05);
        }

        /* Component cards */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .component-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--accent-secondary);
        }

        .component-card h4 {
            color: var(--accent);
            margin-bottom: 10px;
        }

        .component-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .component-card .tag {
            display: inline-block;
            background: var(--accent-secondary);
            color: var(--text-primary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }
            .main-content {
                margin-left: 220px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }

        /* Code blocks */
        code {
            background: var(--bg-card);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
        }

        .file-path {
            color: var(--info);
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <h1>Selfology</h1>
            <p class="subtitle">AI Psychology Coach Architecture</p>

            <div class="nav-section">
                <h3>Overview</h3>
                <a href="#overview" class="nav-link"><span class="icon">üèóÔ∏è</span>System Overview</a>
                <a href="#pipeline" class="nav-link"><span class="icon">üîÑ</span>Message Pipeline</a>
            </div>

            <div class="nav-section">
                <h3>Psychology</h3>
                <a href="#detectors" class="nav-link"><span class="icon">üß†</span>10 Detectors</a>
                <a href="#fingerprint" class="nav-link"><span class="icon">üîê</span>Digital Fingerprint</a>
                <a href="#coach" class="nav-link"><span class="icon">üí¨</span>Coach Response</a>
            </div>

            <div class="nav-section">
                <h3>Infrastructure</h3>
                <a href="#vectors" class="nav-link"><span class="icon">üìä</span>Vector Memory</a>
                <a href="#ai-router" class="nav-link"><span class="icon">ü§ñ</span>AI Router</a>
                <a href="#database" class="nav-link"><span class="icon">üóÑÔ∏è</span>Database Schema</a>
            </div>

            <div class="nav-section">
                <h3>Research</h3>
                <a href="#research" class="nav-link"><span class="icon">üìö</span>Research Mapping</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- 1. System Overview -->
            <section id="overview" class="section">
                <h2>üèóÔ∏è System Overview</h2>
                <p class="description">
                    –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Selfology: –æ—Ç Telegram –¥–æ AI-–æ—Ç–≤–µ—Ç–∞
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "User Interface"
                                TG[Telegram Bot<br/>@SelfologyMeCoachBot]
                            end

                            subgraph "Application Layer"
                                CTRL[SelfologyController<br/>selfology_controller.py]
                                ORCH[OnboardingOrchestrator]
                                COACH[ChatCoachService<br/>services/chat_coach.py]
                                ANAL[AnswerAnalyzer<br/>analysis/answer_analyzer.py]
                            end

                            subgraph "AI Services"
                                ROUTER[AI Router]
                                CLAUDE[Claude Sonnet 4<br/>Crisis/Deep]
                                GPT4[GPT-4o<br/>Emotional/Plans]
                                MINI[GPT-4o-mini<br/>Simple/Fast]
                            end

                            subgraph "Psychological Components"
                                DET[10 Detectors]
                            end

                            subgraph "Storage Layer"
                                PG[(PostgreSQL<br/>selfology schema<br/>port 5434)]
                                REDIS[(Redis<br/>FSM + Cache<br/>port 6379)]
                                QDRANT[(Qdrant<br/>5 Collections<br/>port 6333)]
                            end

                            TG -->|webhook/polling| CTRL
                            CTRL -->|onboarding| ORCH
                            CTRL -->|chat| COACH
                            ORCH --> ANAL
                            COACH --> ANAL
                            ANAL --> DET
                            COACH --> ROUTER
                            ROUTER --> CLAUDE
                            ROUTER --> GPT4
                            ROUTER --> MINI
                            ANAL --> PG
                            ANAL --> QDRANT
                            CTRL --> REDIS

                            style TG fill:#e94560,stroke:#fff
                            style CTRL fill:#533483,stroke:#fff
                            style COACH fill:#533483,stroke:#fff
                            style ROUTER fill:#0f3460,stroke:#fff
                            style CLAUDE fill:#f59e0b,stroke:#fff
                            style GPT4 fill:#10b981,stroke:#fff
                            style MINI fill:#60a5fa,stroke:#fff
                            style PG fill:#3b82f6,stroke:#fff
                            style REDIS fill:#ef4444,stroke:#fff
                            style QDRANT fill:#8b5cf6,stroke:#fff
                    </div>
                </div>

                <div class="info-box">
                    <strong>Key Entry Point:</strong> <code>selfology_controller.py</code> - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞, —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
                </div>

                <table>
                    <tr>
                        <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
                        <th>–§–∞–π–ª</th>
                        <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                    </tr>
                    <tr>
                        <td>SelfologyController</td>
                        <td class="file-path">selfology_controller.py</td>
                        <td>–ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –±–æ—Ç–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, handlers</td>
                    </tr>
                    <tr>
                        <td>OnboardingOrchestrator</td>
                        <td class="file-path">selfology_bot/orchestrator.py</td>
                        <td>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞</td>
                    </tr>
                    <tr>
                        <td>ChatCoachService</td>
                        <td class="file-path">services/chat_coach.py</td>
                        <td>AI –∫–æ—É—á —Å —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏—è–º–∏</td>
                    </tr>
                    <tr>
                        <td>AnswerAnalyzer</td>
                        <td class="file-path">selfology_bot/analysis/answer_analyzer.py</td>
                        <td>–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</td>
                    </tr>
                </table>
            </section>

            <!-- 2. Message Pipeline -->
            <section id="pipeline" class="section">
                <h2>üîÑ Message Processing Pipeline</h2>
                <p class="description">
                    –ü—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as User
                            participant T as Telegram
                            participant C as Controller
                            participant A as AnswerAnalyzer
                            participant D as 10 Detectors
                            participant V as Qdrant
                            participant P as PostgreSQL
                            participant R as AI Router
                            participant AI as Claude/GPT
                            participant CH as ChatCoach

                            U->>T: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
                            T->>C: Webhook/Polling
                            C->>C: Check FSM State

                            alt Onboarding Mode
                                C->>A: analyze_answer()
                                A->>D: Run all detectors
                                D-->>A: Distortions, Defenses, Beliefs...
                                A->>V: Save embeddings
                                A->>P: Save analysis
                                A-->>C: Analysis result
                            else Chat Mode
                                C->>CH: process_message()
                                CH->>V: Semantic search (similar states)
                                CH->>D: Real-time detection
                                CH->>R: Select AI model
                                R->>AI: Generate response
                                AI-->>CH: Raw response
                                CH->>CH: Add interventions
                                CH->>CH: Add deep questions
                                CH-->>C: Final response
                            end

                            C->>T: Send response
                            T->>U: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç
                    </div>
                </div>

                <div class="success-box">
                    <strong>Performance:</strong> –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ~2-5 —Å–µ–∫—É–Ω–¥ (–≤–∫–ª—é—á–∞—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—é)
                </div>

                <h3 style="margin-top: 30px; color: var(--accent);">–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã</h3>

                <div class="component-grid">
                    <div class="component-card">
                        <h4>Onboarding Mode</h4>
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã. –°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–æ–∏—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å.</p>
                        <span class="tag">AnswerAnalyzer</span>
                        <span class="tag">Deep Analysis</span>
                    </div>
                    <div class="component-card">
                        <h4>Chat Mode</h4>
                        <p>–°–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å AI –∫–æ—É—á–µ–º. Real-time –¥–µ—Ç–µ–∫—Ü–∏—è + —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–∏.</p>
                        <span class="tag">ChatCoachService</span>
                        <span class="tag">Interventions</span>
                    </div>
                </div>
            </section>

            <!-- 3. 10 Psychological Detectors -->
            <section id="detectors" class="section">
                <h2>üß† 10 Psychological Detectors</h2>
                <p class="description">
                    –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ AnswerAnalyzer –∏ ChatCoachService
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "Input"
                                MSG[User Message]
                            end

                            subgraph "Detection Layer"
                                CD[CognitiveDistortion<br/>15 —Ç–∏–ø–æ–≤]
                                DM[DefenseMechanism<br/>12 –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤]
                                CB[CoreBeliefs<br/>Young schemas]
                                BS[BlindSpots<br/>4 —Ç–∏–ø–∞]
                                TA[TherapeuticAlliance<br/>WAI-SR]
                                GM[GatingMechanism<br/>10 content types]
                                AS[AttachmentStyle<br/>4 —Å—Ç–∏–ª—è]
                                BD[Breakthrough<br/>5 —Ç–∏–ø–æ–≤]
                                GA[GrowthArea<br/>6 –∑–æ–Ω]
                                MP[MetaPattern<br/>15 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤]
                            end

                            subgraph "Output"
                                ANAL[Analysis Result]
                                RESP[Coach Response]
                            end

                            MSG --> CD
                            MSG --> DM
                            MSG --> CB
                            MSG --> BS
                            MSG --> TA
                            MSG --> GM
                            MSG --> AS
                            MSG --> BD
                            MSG --> GA
                            MSG --> MP

                            CD --> ANAL
                            DM --> ANAL
                            CB --> ANAL
                            BS --> ANAL
                            TA --> GM
                            GM --> RESP
                            AS --> ANAL
                            BD --> RESP
                            GA --> RESP
                            MP --> RESP

                            style CD fill:#ef4444,stroke:#fff
                            style DM fill:#f59e0b,stroke:#fff
                            style CB fill:#10b981,stroke:#fff
                            style BS fill:#3b82f6,stroke:#fff
                            style TA fill:#8b5cf6,stroke:#fff
                            style GM fill:#ec4899,stroke:#fff
                            style AS fill:#14b8a6,stroke:#fff
                            style BD fill:#f97316,stroke:#fff
                            style GA fill:#84cc16,stroke:#fff
                            style MP fill:#6366f1,stroke:#fff
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--accent);">–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h3>

                <table>
                    <tr>
                        <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
                        <th>–ß—Ç–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç</th>
                        <th>–§–∞–π–ª</th>
                        <th>–í–ª–∏—è–Ω–∏–µ –Ω–∞ –æ—Ç–≤–µ—Ç</th>
                    </tr>
                    <tr>
                        <td><strong>CognitiveDistortionDetector</strong></td>
                        <td>15 –∏—Å–∫–∞–∂–µ–Ω–∏–π: –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è, –ß–µ—Ä–Ω–æ-–±–µ–ª–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, –î–æ–ª–∂–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ...</td>
                        <td class="file-path">cognitive_distortion_detector.py</td>
                        <td>–¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∏–¥–±—ç–∫, –º—è–≥–∫–æ–µ –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ</td>
                    </tr>
                    <tr>
                        <td><strong>DefenseMechanismDetector</strong></td>
                        <td>12 –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤: –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –ü—Ä–æ–µ–∫—Ü–∏—è, –û—Ç—Ä–∏—Ü–∞–Ω–∏–µ... + maturity level</td>
                        <td class="file-path">defense_mechanism_detector.py</td>
                        <td>–ü–æ–Ω–∏–º–∞–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –∑–∞—â–∏—Ç</td>
                    </tr>
                    <tr>
                        <td><strong>CoreBeliefsExtractor</strong></td>
                        <td>–ì–ª—É–±–∏–Ω–Ω—ã–µ —É–±–µ–∂–¥–µ–Ω–∏—è –ø–æ —Å—Ö–µ–º–∞–º –Ø–Ω–≥–∞, valence (-1 to 1)</td>
                        <td class="file-path">core_beliefs_extractor.py</td>
                        <td>–í—ã—è–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤—ã—Ö –ø—Ä–∏—á–∏–Ω</td>
                    </tr>
                    <tr>
                        <td><strong>BlindSpotDetector</strong></td>
                        <td>4 —Ç–∏–ø–∞: –ò–∑–±–µ–≥–∞–Ω–∏–µ, –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ, –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</td>
                        <td class="file-path">blind_spot_detector.py</td>
                        <td>Surfacing –ø—Ä–∏ high alliance</td>
                    </tr>
                    <tr>
                        <td><strong>TherapeuticAllianceTracker</strong></td>
                        <td>WAI-SR: bond, task, goal + engagement, disclosure</td>
                        <td class="file-path">therapeutic_alliance_tracker.py</td>
                        <td>–ö–æ–Ω—Ç—Ä–æ–ª—å –≥–ª—É–±–∏–Ω—ã –∏–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–π</td>
                    </tr>
                    <tr>
                        <td><strong>GatingMechanism</strong></td>
                        <td>10 —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø–æ—Ä–æ–≥–∞–º–∏ alliance –∏ –≤—Ä–µ–º–µ–Ω–∏</td>
                        <td class="file-path">gating_mechanism.py</td>
                        <td>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤</td>
                    </tr>
                    <tr>
                        <td><strong>AttachmentStyleClassifier</strong></td>
                        <td>4 —Å—Ç–∏–ª—è: secure, anxious, avoidant, disorganized</td>
                        <td class="file-path">attachment_style_classifier.py</td>
                        <td>–ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</td>
                    </tr>
                    <tr>
                        <td><strong>BreakthroughDetector</strong></td>
                        <td>5 —Ç–∏–ø–æ–≤: insight, emotional_release, belief_shift, defense_lowering, integration</td>
                        <td class="file-path">breakthrough_detector.py</td>
                        <td>Celebration responses</td>
                    </tr>
                    <tr>
                        <td><strong>GrowthAreaTracker</strong></td>
                        <td>6 –∑–æ–Ω: self_compassion, emotional_awareness, boundary_setting...</td>
                        <td class="file-path">growth_area_tracker.py</td>
                        <td>Progress feedback</td>
                    </tr>
                    <tr>
                        <td><strong>MetaPatternAnalyzer</strong></td>
                        <td>15 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤: work_overwhelm, perfectionism, catastrophizing...</td>
                        <td class="file-path">meta_pattern_analyzer.py</td>
                        <td>Therapeutic insights –æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è—Ö</td>
                    </tr>
                </table>

                <div class="warning-box">
                    <strong>–í–∞–∂–Ω–æ:</strong> –í—Å–µ –¥–µ—Ç–µ–∫—Ç–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä—É—Å—Å–∫–∏–µ regex-–ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞
                </div>
            </section>

            <!-- 4. Digital Fingerprint -->
            <section id="fingerprint" class="section">
                <h2>üîê Digital Fingerprint (–¶–∏—Ñ—Ä–æ–≤–æ–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫)</h2>
                <p class="description">
                    –ö–∞–∫ —Å—Ç—Ä–æ–∏—Ç—Å—è –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "User Input"
                                ANS[–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã]
                                MSG[–°–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ]
                            end

                            subgraph "Analysis"
                                ANAL[AnswerAnalyzer]
                                DET[10 Detectors]
                            end

                            subgraph "4-Layer Personality Model"
                                L1[Layer 1: Big Five<br/>Openness, Conscientiousness,<br/>Extraversion, Agreeableness, Neuroticism]
                                L2[Layer 2: Dynamic Traits<br/>Emotional regulation, Stress response,<br/>Cognitive flexibility]
                                L3[Layer 3: Adaptive Traits<br/>Coping styles, Defense patterns,<br/>Attachment behaviors]
                                L4[Layer 4: Domain Traits<br/>Work, Relationships, Health,<br/>Self-perception]
                            end

                            subgraph "Vector Representation"
                                V512[512D - Quick matching]
                                V1536[1536D - Detailed analysis]
                                V3072[3072D - Deep patterns]
                            end

                            subgraph "Storage"
                                PG[(PostgreSQL<br/>digital_personality)]
                                QD[(Qdrant<br/>psychological_constructs)]
                            end

                            ANS --> ANAL
                            MSG --> ANAL
                            ANAL --> DET
                            DET --> L1
                            DET --> L2
                            DET --> L3
                            DET --> L4

                            L1 --> V512
                            L2 --> V1536
                            L3 --> V1536
                            L4 --> V3072

                            V512 --> QD
                            V1536 --> QD
                            V3072 --> QD
                            L1 --> PG
                            L2 --> PG
                            L3 --> PG
                            L4 --> PG

                            style L1 fill:#3b82f6,stroke:#fff
                            style L2 fill:#8b5cf6,stroke:#fff
                            style L3 fill:#ec4899,stroke:#fff
                            style L4 fill:#f97316,stroke:#fff
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--accent);">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è</h3>

                <div class="component-grid">
                    <div class="component-card">
                        <h4>Layer 1: Big Five</h4>
                        <p>–ë–∞–∑–æ–≤—ã–µ —á–µ—Ä—Ç—ã –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ –º–æ–¥–µ–ª–∏ OCEAN</p>
                        <ul style="margin-top: 10px; padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>Openness (–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –æ–ø—ã—Ç—É)</li>
                            <li>Conscientiousness (–î–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç—å)</li>
                            <li>Extraversion (–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è)</li>
                            <li>Agreeableness (–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)</li>
                            <li>Neuroticism (–ù–µ–π—Ä–æ—Ç–∏–∑–º)</li>
                        </ul>
                        <span class="tag">–°—Ç–∞–±–∏–ª—å–Ω—ã–µ</span>
                    </div>
                    <div class="component-card">
                        <h4>Layer 2: Dynamic Traits</h4>
                        <p>–ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</p>
                        <ul style="margin-top: 10px; padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>Emotional regulation</li>
                            <li>Stress response</li>
                            <li>Cognitive flexibility</li>
                            <li>Self-efficacy</li>
                        </ul>
                        <span class="tag">EMA smoothing</span>
                    </div>
                    <div class="component-card">
                        <h4>Layer 3: Adaptive Traits</h4>
                        <p>–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è</p>
                        <ul style="margin-top: 10px; padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>Coping styles</li>
                            <li>Defense patterns</li>
                            <li>Attachment behaviors</li>
                            <li>Relational patterns</li>
                        </ul>
                        <span class="tag">From detectors</span>
                    </div>
                    <div class="component-card">
                        <h4>Layer 4: Domain Traits</h4>
                        <p>–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ</p>
                        <ul style="margin-top: 10px; padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>Work patterns</li>
                            <li>Relationship dynamics</li>
                            <li>Health attitudes</li>
                            <li>Self-perception</li>
                        </ul>
                        <span class="tag">Domain-specific</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>132-point Evolution:</strong> VectorStorytelling –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç 132 —Ç–æ—á–∫–∏ —ç–≤–æ–ª—é—Ü–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                </div>
            </section>

            <!-- 5. Coach Response Generation -->
            <section id="coach" class="section">
                <h2>üí¨ Coach Response Generation</h2>
                <p class="description">
                    –ö–∞–∫ ChatCoachService —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "Input"
                                MSG[User Message]
                                CTX[User Context<br/>Profile + History]
                            end

                            subgraph "Real-time Detection"
                                BD[BreakthroughDetector]
                                GA[GrowthAreaTracker]
                                MP[MetaPatternAnalyzer]
                                CD[CognitiveDistortionDetector]
                            end

                            subgraph "Semantic Search"
                                EMB[Create Embedding]
                                SIM[Find Similar States<br/>in episodic_memory]
                            end

                            subgraph "Response Components"
                                ACS[Adaptive Communication Style<br/>depth + tone + structure]
                                DQG[Deep Question Generator<br/>5 categories]
                                MI[Micro Interventions<br/>reframing, anchoring, challenge]
                                CC[Confidence Calculator<br/>5 factors]
                            end

                            subgraph "AI Generation"
                                ROUTER[AI Router]
                                AI[Claude / GPT-4 / Mini]
                            end

                            subgraph "Final Assembly"
                                GATE[Gating Check]
                                ASSEMBLE[Combine:<br/>Response + Questions +<br/>Interventions + Celebrations]
                            end

                            MSG --> BD
                            MSG --> GA
                            MSG --> MP
                            MSG --> CD
                            MSG --> EMB
                            EMB --> SIM

                            CTX --> ACS
                            ACS --> AI

                            BD --> ASSEMBLE
                            GA --> ASSEMBLE
                            MP --> ASSEMBLE
                            CD --> GATE
                            SIM --> AI

                            MSG --> ROUTER
                            ROUTER --> AI
                            AI --> ASSEMBLE

                            DQG --> ASSEMBLE
                            MI --> ASSEMBLE
                            CC --> ASSEMBLE
                            GATE --> ASSEMBLE

                            ASSEMBLE --> RESP[Final Response]

                            style ACS fill:#8b5cf6,stroke:#fff
                            style DQG fill:#3b82f6,stroke:#fff
                            style MI fill:#ec4899,stroke:#fff
                            style CC fill:#10b981,stroke:#fff
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--accent);">6 Active Components in ChatCoachService</h3>

                <table>
                    <tr>
                        <th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>
                        <th>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç</th>
                        <th>–ü—Ä–∏–º–µ—Ä –≤—ã—Ö–æ–¥–∞</th>
                    </tr>
                    <tr>
                        <td><strong>Adaptive Communication Style</strong></td>
                        <td>–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –≥–ª—É–±–∏–Ω—É, —Ç–æ–Ω, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–¥ Big Five</td>
                        <td>High openness ‚Üí profound depth, narrative structure</td>
                    </tr>
                    <tr>
                        <td><strong>Deep Question Generator</strong></td>
                        <td>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 1-2 –≥–ª—É–±–æ–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–∞ –ø–æ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</td>
                        <td>"–ß—Ç–æ —Å—Ç–æ–∏—Ç –∑–∞ —ç—Ç–∏–º –∂–µ–ª–∞–Ω–∏–µ–º?" (desire category)</td>
                    </tr>
                    <tr>
                        <td><strong>Micro Interventions</strong></td>
                        <td>Reframing, Anchoring, Gentle Challenge</td>
                        <td>"–ê —á—Ç–æ –µ—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —ç—Ç–æ –∫–∞–∫ –Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å?"</td>
                    </tr>
                    <tr>
                        <td><strong>Confidence Calculator</strong></td>
                        <td>–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ 5 —Ñ–∞–∫—Ç–æ—Ä–∞–º</td>
                        <td>"–£–≤–µ—Ä–µ–Ω (85%)" / "–ì–∏–ø–æ—Ç–µ–∑–∞ (45%)"</td>
                    </tr>
                    <tr>
                        <td><strong>Vector Storytelling</strong></td>
                        <td>–ù–∞—Ä—Ä–∞—Ç–∏–≤ –æ 132-point —ç–≤–æ–ª—é—Ü–∏–∏</td>
                        <td>"2 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥ –≤—ã –±—ã–ª–∏ –≤ –ø–æ—Ö–æ–∂–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏..."</td>
                    </tr>
                    <tr>
                        <td><strong>Enhanced AI Router</strong></td>
                        <td>–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –ø–æ psychological context</td>
                        <td>Crisis ‚Üí Claude, Action plan ‚Üí GPT-4</td>
                    </tr>
                </table>

                <div class="success-box">
                    <strong>Impact:</strong> Response length +300%, Messages/session +300%, Insights/session +400%
                </div>
            </section>

            <!-- 6. Vector Memory System -->
            <section id="vectors" class="section">
                <h2>üìä Vector Memory System (Qdrant)</h2>
                <p class="description">
                    5 –∫–æ–ª–ª–µ–∫—Ü–∏–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "Embedding Models"
                                RB[RuBERT<br/>768d]
                                OAI[OpenAI<br/>1536d/2048d/1024d]
                            end

                            subgraph "Qdrant Collections"
                                EM[episodic_memory<br/>768d - RuBERT<br/>–î–∏–∞–ª–æ–≥–∏, –æ—Ç–≤–µ—Ç—ã]
                                SK[semantic_knowledge<br/>2048d - OpenAI<br/>AI –∞–Ω–∞–ª–∏–∑—ã]
                                ET[emotional_thematic<br/>1536d - Hybrid<br/>–≠–º–æ—Ü–∏–∏, —Ç–µ–º—ã]
                                PC[psychological_constructs<br/>1024d - OpenAI<br/>Beliefs, distortions]
                                MP[meta_patterns<br/>1024d - OpenAI<br/>Blind spots, patterns]
                            end

                            subgraph "Usage"
                                SEARCH[Semantic Search<br/>Similar states]
                                ENRICH[Context Enrichment<br/>Historical patterns]
                                TRACK[Pattern Tracking<br/>Evolution over time]
                            end

                            RB --> EM
                            OAI --> SK
                            OAI --> ET
                            OAI --> PC
                            OAI --> MP

                            EM --> SEARCH
                            SK --> ENRICH
                            ET --> ENRICH
                            PC --> TRACK
                            MP --> TRACK

                            style EM fill:#3b82f6,stroke:#fff
                            style SK fill:#8b5cf6,stroke:#fff
                            style ET fill:#ec4899,stroke:#fff
                            style PC fill:#10b981,stroke:#fff
                            style MP fill:#f97316,stroke:#fff
                    </div>
                </div>

                <table>
                    <tr>
                        <th>Collection</th>
                        <th>Dimensions</th>
                        <th>Model</th>
                        <th>–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç</th>
                        <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</th>
                    </tr>
                    <tr>
                        <td><strong>episodic_memory</strong></td>
                        <td>768</td>
                        <td>RuBERT Conversational</td>
                        <td>–û—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</td>
                        <td>Semantic search, similar states</td>
                    </tr>
                    <tr>
                        <td><strong>semantic_knowledge</strong></td>
                        <td>2048</td>
                        <td>OpenAI text-embedding-3-large</td>
                        <td>AI –∞–Ω–∞–ª–∏–∑—ã, –∏–Ω—Å–∞–π—Ç—ã</td>
                        <td>Context enrichment</td>
                    </tr>
                    <tr>
                        <td><strong>emotional_thematic</strong></td>
                        <td>1536</td>
                        <td>Hybrid composition</td>
                        <td>–≠–º–æ—Ü–∏–∏, —Ç–µ–º—ã</td>
                        <td>Pattern matching</td>
                    </tr>
                    <tr>
                        <td><strong>psychological_constructs</strong></td>
                        <td>1024</td>
                        <td>OpenAI</td>
                        <td>Core beliefs, distortions, defenses</td>
                        <td>Construct tracking</td>
                    </tr>
                    <tr>
                        <td><strong>meta_patterns</strong></td>
                        <td>1024</td>
                        <td>OpenAI</td>
                        <td>Blind spots, recurring patterns</td>
                        <td>Evolution tracking</td>
                    </tr>
                </table>

                <div class="info-box">
                    <strong>Performance:</strong> ~200ms embedding creation + &lt;20ms Qdrant search
                </div>
            </section>

            <!-- 7. AI Router -->
            <section id="ai-router" class="section">
                <h2>ü§ñ AI Router (Intelligent Model Selection)</h2>
                <p class="description">
                    –£–º–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "Input Analysis"
                                MSG[User Message]
                                CTX[Psychological Context]
                            end

                            subgraph "Decision Factors"
                                CRISIS[Crisis Detection]
                                EXIST[Existential Questions]
                                DEPTH[Depth Level<br/>SHADOW/CORE]
                                COMPLEX[Task Complexity]
                                TIER[User Tier]
                            end

                            subgraph "Model Selection"
                                CLAUDE[Claude Sonnet 4<br/>~10% traffic<br/>$$$]
                                GPT4[GPT-4o<br/>~75% traffic<br/>$$]
                                MINI[GPT-4o-mini<br/>~15% traffic<br/>$]
                            end

                            MSG --> CRISIS
                            MSG --> EXIST
                            CTX --> DEPTH
                            MSG --> COMPLEX
                            CTX --> TIER

                            CRISIS -->|Yes| CLAUDE
                            EXIST -->|Yes| CLAUDE
                            DEPTH -->|SHADOW/CORE| CLAUDE
                            COMPLEX -->|High| GPT4
                            COMPLEX -->|Medium| GPT4
                            COMPLEX -->|Low| MINI

                            style CLAUDE fill:#f59e0b,stroke:#fff
                            style GPT4 fill:#10b981,stroke:#fff
                            style MINI fill:#60a5fa,stroke:#fff
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--accent);">Routing Rules</h3>

                <table>
                    <tr>
                        <th>–£—Å–ª–æ–≤–∏–µ</th>
                        <th>–ú–æ–¥–µ–ª—å</th>
                        <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                    </tr>
                    <tr>
                        <td>Crisis detected (suicidal ideation, self-harm)</td>
                        <td><strong>Claude Sonnet 4</strong></td>
                        <td>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω—é–∞–Ω—Å—ã</td>
                    </tr>
                    <tr>
                        <td>Existential questions (—Å–º—ã—Å–ª –∂–∏–∑–Ω–∏, —Å–º–µ—Ä—Ç—å)</td>
                        <td><strong>Claude Sonnet 4</strong></td>
                        <td>–ì–ª—É–±–æ–∫–æ–µ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ</td>
                    </tr>
                    <tr>
                        <td>Depth level = SHADOW or CORE</td>
                        <td><strong>Claude Sonnet 4</strong></td>
                        <td>–†–∞–±–æ—Ç–∞ —Å –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–º</td>
                    </tr>
                    <tr>
                        <td>Action plans, structured guidance</td>
                        <td><strong>GPT-4o</strong></td>
                        <td>–•–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç—É</td>
                    </tr>
                    <tr>
                        <td>Emotional support, validation</td>
                        <td><strong>GPT-4o</strong></td>
                        <td>–≠–º–ø–∞—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</td>
                    </tr>
                    <tr>
                        <td>Simple chat, clarifications</td>
                        <td><strong>GPT-4o-mini</strong></td>
                        <td>–ë—ã—Å—Ç—Ä–æ –∏ –¥–µ—à–µ–≤–æ</td>
                    </tr>
                </table>

                <div class="success-box">
                    <strong>Cost Savings:</strong> ~75% —ç–∫–æ–Ω–æ–º–∏–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞–µ–≤
                </div>
            </section>

            <!-- 8. Database Schema -->
            <section id="database" class="section">
                <h2>üóÑÔ∏è Database Schema (PostgreSQL)</h2>
                <p class="description">
                    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ <code>selfology</code> (port 5434)
                </p>

                <div class="diagram-container">
                    <div class="mermaid">
                        erDiagram
                            users ||--o{ onboarding_sessions : has
                            onboarding_sessions ||--o{ user_answers_new : contains
                            user_answers_new ||--o{ answer_analysis : analyzed_by
                            users ||--o{ digital_personality : has
                            users ||--o{ personality_profiles : has

                            users {
                                int id PK
                                bigint telegram_id
                                string username
                                timestamp created_at
                                json settings
                            }

                            onboarding_sessions {
                                int id PK
                                int user_id FK
                                string status
                                int answer_count
                                timestamp started_at
                            }

                            user_answers_new {
                                int id PK
                                int session_id FK
                                string question_json_id
                                text raw_answer
                                string analysis_status
                            }

                            answer_analysis {
                                int id PK
                                int user_answer_id FK
                                json analysis_result
                                int version
                                string model_used
                            }

                            digital_personality {
                                int id PK
                                int user_id FK
                                json big_five
                                json dynamic_traits
                                json adaptive_traits
                                json domain_traits
                            }

                            cognitive_distortions {
                                int id PK
                                int user_id FK
                                string distortion_type
                                float confidence
                                text evidence
                            }

                            defense_mechanisms {
                                int id PK
                                int user_id FK
                                string mechanism_type
                                string maturity_level
                                float strength
                            }

                            core_beliefs {
                                int id PK
                                int user_id FK
                                text belief_text
                                float valence
                                float confidence
                            }
                    </div>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--accent);">–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã</h3>

                <div class="component-grid">
                    <div class="component-card">
                        <h4>User Data</h4>
                        <ul style="padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>users</li>
                            <li>onboarding_sessions</li>
                            <li>user_answers_new</li>
                            <li>answer_analysis</li>
                        </ul>
                    </div>
                    <div class="component-card">
                        <h4>Personality</h4>
                        <ul style="padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>digital_personality</li>
                            <li>personality_profiles</li>
                            <li>personality_states</li>
                        </ul>
                    </div>
                    <div class="component-card">
                        <h4>Psychological Constructs</h4>
                        <ul style="padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>cognitive_distortions</li>
                            <li>defense_mechanisms</li>
                            <li>core_beliefs</li>
                            <li>blind_spots</li>
                            <li>attachment_patterns</li>
                            <li>growth_areas</li>
                        </ul>
                    </div>
                    <div class="component-card">
                        <h4>Therapeutic</h4>
                        <ul style="padding-left: 20px; color: var(--text-secondary); font-size: 0.85rem;">
                            <li>alliance_measurements</li>
                            <li>breakthrough_moments</li>
                            <li>questions_metadata</li>
                        </ul>
                    </div>
                </div>

                <div class="warning-box">
                    <strong>Connection:</strong> host=localhost, port=5434, user=selfology_user, database=selfology
                </div>
            </section>

            <!-- 9. Research Mapping -->
            <section id="research" class="section">
                <h2>üìö Research to Implementation Mapping</h2>
                <p class="description">
                    –ö–∞–∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏–∑ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –∫–æ–¥–µ
                </p>

                <table>
                    <tr>
                        <th>Research Concept</th>
                        <th>Implementation</th>
                        <th>Files</th>
                    </tr>
                    <tr>
                        <td>Multi-layer Personality Model</td>
                        <td>4 —Å–ª–æ—è traits –≤ digital_personality</td>
                        <td class="file-path">models/digital_personality.py</td>
                    </tr>
                    <tr>
                        <td>Temporal Dynamics</td>
                        <td>EMA smoothing, 132-point evolution</td>
                        <td class="file-path">vector_storytelling.py</td>
                    </tr>
                    <tr>
                        <td>Therapeutic Alliance (WAI-SR)</td>
                        <td>TherapeuticAllianceTracker</td>
                        <td class="file-path">therapeutic_alliance_tracker.py</td>
                    </tr>
                    <tr>
                        <td>Gating for Safety</td>
                        <td>GatingMechanism with 10 content types</td>
                        <td class="file-path">gating_mechanism.py</td>
                    </tr>
                    <tr>
                        <td>Cognitive Distortion Theory (Beck)</td>
                        <td>15 distortion types with patterns</td>
                        <td class="file-path">cognitive_distortion_detector.py</td>
                    </tr>
                    <tr>
                        <td>Defense Mechanisms (Freud/Vaillant)</td>
                        <td>12 mechanisms with maturity levels</td>
                        <td class="file-path">defense_mechanism_detector.py</td>
                    </tr>
                    <tr>
                        <td>Young Schema Therapy</td>
                        <td>CoreBeliefsExtractor</td>
                        <td class="file-path">core_beliefs_extractor.py</td>
                    </tr>
                    <tr>
                        <td>Attachment Theory (Bowlby)</td>
                        <td>AttachmentStyleClassifier</td>
                        <td class="file-path">attachment_style_classifier.py</td>
                    </tr>
                    <tr>
                        <td>Breakthrough Moments</td>
                        <td>5 types: insight, release, shift, lowering, integration</td>
                        <td class="file-path">breakthrough_detector.py</td>
                    </tr>
                    <tr>
                        <td>Growth Zones (ZPD)</td>
                        <td>6 growth areas with progress tracking</td>
                        <td class="file-path">growth_area_tracker.py</td>
                    </tr>
                </table>

                <div class="info-box">
                    <strong>Source:</strong> <span class="file-path">research/–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ –¥–ª—è AI-–∫–æ—É—á–∞.md</span>
                </div>
            </section>

            <!-- Footer -->
            <footer style="text-align: center; padding: 40px; color: var(--text-secondary);">
                <p>Selfology Architecture Documentation</p>
                <p style="font-size: 0.85rem;">Generated: <script>document.write(new Date().toISOString().split('T')[0])</script></p>
            </footer>
        </main>
    </div>

    <script>
        // Initialize Mermaid with dark theme
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#533483',
                primaryTextColor: '#e8e8e8',
                primaryBorderColor: '#e94560',
                lineColor: '#a0a0a0',
                secondaryColor: '#0f3460',
                tertiaryColor: '#16213e'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            },
            sequence: {
                actorMargin: 50,
                messageMargin: 40
            }
        });

        // Active nav link highlighting
        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav-link');

            window.addEventListener('scroll', () => {
                let current = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (scrollY >= sectionTop - 100) {
                        current = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + current) {
                        link.classList.add('active');
                    }
                });
            });
        });
    </script>
</body>
</html>
